{
  "testInfo": {
    "id": "test_007",
    "option": "専用スタンドあり",
    "shipping": "ゆうパック",
    "payment": "代引き"
  },
  "url": "https://calendar.shimaumaprint.com/edit/",
  "credentialKey": "dev",
  "device": "pc",
  "headless": true,
  "actions": [
    {
      "type": "waitForSelector",
      "selector": "text=ましかくサイズ",
      "timeout": 30000
    },
    {
      "type": "click",
      "selector": "text=ましかくサイズ"
    },
    {
      "type": "waitForSelector",
      "selector": "text=次へ",
      "timeout": 10000
    },
    {
      "type": "click",
      "selector": "text=次へ"
    },
    {
      "type": "waitForSelector",
      "selector": "text=ストライプA001",
      "timeout": 10000
    },
    {
      "type": "click",
      "selector": "text=ストライプA001"
    },
    {
      "type": "waitForSelector",
      "selector": "text=/写真/",
      "timeout": 10000
    },
    {
      "type": "click",
      "selector": "text=/写真/"
    },
    {
      "type": "wait",
      "x": 1000
    },
    {
      "type": "uploadFile",
      "selector": "input[type=file]",
      "filePath": "./assets/images/anna-hunko-TjxjFl9nWlc-unsplash.jpg"
    },
    {
      "type": "waitForSelector",
      "selector": "text=自動配置",
      "timeout": 30000
    },
    {
      "type": "click",
      "selector": "text=自動配置"
    },
    {
      "type": "wait",
      "x": 1000
    },
    {
      "type": "evaluate",
      "value": "const btns = Array.from(document.querySelectorAll('button')).filter(b => b.textContent.trim() === 'OK'); if(btns.length > 0) { btns[0].click(); 'clicked OK'; } else { 'no dialog'; }"
    },
    {
      "type": "waitForSelector",
      "selector": "text=/注文する/",
      "timeout": 30000
    },
    {
      "type": "evaluate",
      "value": "const btn = Array.from(document.querySelectorAll('button, a, [role=button]')).find(el => el.textContent.includes('注文')); if(btn) { btn.click(); 'clicked'; } else { 'not found'; }"
    },
    {
      "type": "waitForSelector",
      "selector": "text=はい",
      "timeout": 10000
    },
    {
      "type": "click",
      "selector": "text=はい"
    },
    {
      "type": "waitForSelector",
      "selector": "#input-username",
      "timeout": 30000
    },
    {
      "type": "fill",
      "selector": "#input-username",
      "value": "{{LOGIN_USER}}"
    },
    {
      "type": "waitForSelector",
      "selector": "#input-password",
      "timeout": 5000
    },
    {
      "type": "fill",
      "selector": "#input-password",
      "value": "{{LOGIN_PASS}}"
    },
    {
      "type": "wait",
      "x": 500
    },
    {
      "type": "click",
      "selector": "#btn-simple-login"
    },
    {
      "type": "waitForSelector",
      "selector": ".box-wrapper.option",
      "timeout": 60000
    },
    {
      "type": "click",
      "selector": ".box-wrapper.option.rounded-top button"
    },
    {
      "type": "waitForSelector",
      "selector": "text=配送先を選ぶ",
      "timeout": 10000
    },
    {
      "type": "click",
      "selector": "text=配送先を選ぶ"
    },
    {
      "type": "waitForSelector",
      "selector": "text=/ゆうパック/",
      "timeout": 30000
    },
    {
      "type": "click",
      "selector": "text=/ゆうパック/"
    },
    {
      "type": "waitForSelector",
      "selector": "text=お支払いへ進む",
      "timeout": 10000
    },
    {
      "type": "click",
      "selector": "text=お支払いへ進む"
    },
    {
      "type": "waitForSelector",
      "selector": "text=/代引き/",
      "timeout": 30000
    },
    {
      "type": "click",
      "selector": "text=/代引き/"
    },
    {
      "type": "waitForSelector",
      "selector": "text=ご注文内容を確認する",
      "timeout": 10000
    },
    {
      "type": "click",
      "selector": "text=ご注文内容を確認する"
    },
    {
      "type": "waitForSelector",
      "selector": "text=注文を確定する",
      "timeout": 30000
    },
    {
      "type": "screenshotFullPage"
    },
    {
      "type": "click",
      "selector": "text=注文を確定する"
    },
    {
      "type": "wait",
      "x": 5000
    },
    {
      "type": "evaluate",
      "value": "\n        (async () => {\n            const maxWait = 30000;\n            const startTime = Date.now();\n            while (Date.now() - startTime < maxWait) {\n                // 完了ページのURLかチェック\n                if (window.location.href.includes('complete')) {\n                    return 'complete_url';\n                }\n                // 「閉じる」ボタンがあるかチェック\n                const closeBtn = document.querySelector('button, a, [role=button]');\n                const allElements = Array.from(document.querySelectorAll('button, a, span, div'));\n                const hasClose = allElements.some(el => el.textContent && el.textContent.includes('閉じる'));\n                if (hasClose) {\n                    return 'close_button';\n                }\n                // 「マイページへ」ボタンがあるかチェック\n                const hasMypage = allElements.some(el => el.textContent && el.textContent.includes('マイページへ'));\n                if (hasMypage) {\n                    return 'mypage_button';\n                }\n                // 注文完了メッセージがあるかチェック\n                const hasComplete = document.body.innerText.includes('ご注文ありがとう') || document.body.innerText.includes('注文を承りました');\n                if (hasComplete) {\n                    return 'complete_message';\n                }\n                await new Promise(r => setTimeout(r, 500));\n            }\n            return 'timeout';\n        })()\n    "
    },
    {
      "type": "screenshot"
    },
    {
      "type": "evaluate",
      "value": "const btn = Array.from(document.querySelectorAll('button, a, [role=button]')).find(el => el.textContent && el.textContent.includes('閉じる')); if(btn) { btn.click(); 'clicked'; } else { 'no close button'; }"
    },
    {
      "type": "wait",
      "x": 1000
    },
    {
      "type": "evaluate",
      "value": "const btn = Array.from(document.querySelectorAll('button, a, [role=button]')).find(el => el.textContent && el.textContent.includes('マイページ')); if(btn) { btn.click(); 'clicked'; } else { 'no mypage button'; }"
    },
    {
      "type": "wait",
      "x": 2000
    },
    {
      "type": "screenshot"
    },
    {
      "type": "getCurrentUrl"
    },
    {
      "type": "getTitle"
    }
  ]
}